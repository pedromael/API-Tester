<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="app:///node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style/main.css" />
  <script src="app:///node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="scripts/main.js"></script>
  <title>API Tester</title>
</head>
<body>

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    .main-content {
      position: absolute;
      top: 56px;    /* altura do navbar */
      bottom: 0;
      left: 0;
      right: 0;
      padding: 1rem;
      overflow: hidden; /* esconde rolagem global */
    }
    /* Colunas scrolláveis de forma independente */
    .scrollable-col {
      height: 100%;
      overflow-y: auto;
    }
  </style>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-sm navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">API Tester</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item me-2">
            <span class="navbar-text me-2">Modo Escuro</span>
            <div class="form-check form-switch d-inline-block">
              <input class="form-check-input" type="checkbox" id="themeToggle">
            </div>
          </li>
          <li class="nav-item">
            <button class="btn btn-outline-light me-1" id="importButton" onclick="importar()">Importar</button>
            <button class="btn btn-outline-light" id="exportButton" onclick="exportar()">Exportar</button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="main-content container-fluid">
    <div class="row h-100 gx-4">
      <div class="col-md-7 scrollable-col">
        <form id="apiForm">
          <div class="mb-3">
            <label for="url" class="form-label">URL</label>
            <input type="text" class="form-control" id="url" placeholder="Insira a URL da API" />
          </div>
          <div class="mb-3">
            <label for="accessToken" class="form-label">Access Token</label>
            <input type="text" class="form-control" id="accessToken" placeholder="Insira o access token" />
          </div>
          <div class="mb-3">
            <div class="container p-0">
              <div class="row">
                <div class="col-auto">
                  <label for="method" class="form-label">Method</label>
                </div>
                <div class="col">
                  <select class="form-select" id="method">
                    <option value="GET" selected>GET</option>
                    <option value="POST">POST</option>
                    <option value="PUT">PUT</option>
                    <option value="DELETE">DELETE</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label">Automação</label>
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="autoToggle">
              <label class="form-check-label" for="autoToggle">Ativar Automação</label>
            </div>
            <div class="row mt-2">
              <div class="col-md-6">
                <input type="number" id="intervalo" class="form-control" placeholder="Intervalo em segundos" disabled />
              </div>
              <div class="col-md-6">
                <input type="datetime-local" class="form-control" id="data-auto-termino" disabled />
              </div>
            </div>
          </div>

          <script>
            $(document).ready(function () {
              $("#autoToggle").on("change", function () {
                const isEnabled = $(this).is(":checked");
                $("#intervalo, #data-auto-termino").prop("disabled", !isEnabled);
              });
            });
          </script>

          <div class="mb-3">
            <label class="form-label">Formato do Request Body</label>
            <div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="bodyMethod" id="jsonTextRadio" value="json" checked />
                <label class="form-check-label" for="jsonTextRadio">JSON Text</label>
              </div>
              <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="bodyMethod" id="keyValueRadio" value="keyValue" />
                <label class="form-check-label" for="keyValueRadio">Key-Value</label>
              </div>
            </div>
          </div>

          <div id="jsonTextBody" class="mb-3">
            <textarea class="form-control" id="body" rows="5" placeholder='{"key": "value"}'></textarea>
          </div>

          <div id="keyValueBody" class="mb-3" style="display: none;">
            <div id="keyValuePairs">
              <div class="row align-items-center mb-2">
                <div class="col">
                  <input type="text" class="form-control" placeholder="Key" />
                </div>
                <div class="col">
                  <input type="text" class="form-control" placeholder="Value" />
                </div>
                <div class="col-auto">
                  <button class="btn btn-danger remove-field" type="button">&times;</button>
                </div>
              </div>
            </div>
            <button type="button" class="btn btn-secondary mt-2" id="addField">Add Field</button>
          </div>

          <button type="button" class="btn btn-primary" onclick="sendRequest()">Send Request</button>
          <button type="button" class="btn btn-secondary ms-2" onclick="clearResponse()">Clear Response</button>
        </form>
      </div>

      <div class="col-md-5 scrollable-col">
        <div class="container">
          <h2 class="mt-4">API Response</h2>
          <pre id="response" class="dark-mode"></pre>
        </div>
        <div class="container">
          <h2>Históricos</h2>
          <ul id="historyList" class="list-group"></ul>
          <button class="btn btn-danger mt-3" onclick="clearHistory()">Limpar Histórico</button>
        </div>
      </div>
    </div>
  </div>

  <script src="scripts/others.js"></script>
  <script src="style/stilo.js"></script>

  <script>
    $(document).ready(function () {
      const darkMode = localStorage.getItem("darkMode") === "enabled";
      $("#themeToggle").prop("checked", darkMode);
      if (darkMode) $("body").addClass("dark-mode");

      $("#themeToggle").on("change", function () {
        if (this.checked) {
          $("body").addClass("dark-mode");
          localStorage.setItem("darkMode", "enabled");
        } else {
          $("body").removeClass("dark-mode");
          localStorage.setItem("darkMode", "disabled");
        }
      });
    });
  </script>

</body>
</html>
